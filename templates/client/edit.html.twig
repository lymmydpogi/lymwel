{% extends 'base.html.twig' %}

{% block title %}Edit Client{% endblock %}
{% block page_title %}Edit Client{% endblock %}

{% block stylesheets %}
{{ parent() }}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"/>

<style>
.page-header {
    text-align: center;
    margin-bottom: 40px;
}
.page-header h1 {
    font-size: 32px;
    font-weight: 700;
    margin: 0 0 10px 0;
    color: #1a1a1a;
}
.page-header p {
    font-size: 16px;
    color: #6b7280;
    margin: 0;
}

/* Form */
.form-container {
    background: #ffffff;
    border-radius: 16px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
    padding: 40px;
    max-width: 800px;
    margin: 0 auto 40px;
    border: 1px solid #f0f0f0;
}
.form-group {
    display: flex;
    flex-direction: column;
    margin-bottom: 24px;
}
.form-group label {
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 8px;
    font-size: 14px;
}
.form-container input,
.form-container select,
.form-container textarea {
    width: 100%;
    padding: 12px 16px;
    font-size: 14px;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
    background: #ffffff;
    color: #1a1a1a;
    transition: all 0.2s;
}
.form-container input:focus,
.form-container select:focus,
.form-container textarea:focus {
    outline: none;
    border-color: #8b5cf6;
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
}

.form-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-start;
    align-items: center;
    margin-top: 30px;
    padding-top: 30px;
    border-top: 1px solid #f0f0f0;
}

.btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s;
}
.btn:hover { transform: translateY(-1px); }

.btn-update {
    background: #8b5cf6;
    color: white;
}
.btn-update:hover { background: #7c3aed; }

.btn-delete {
    background: #ef4444;
    color: white;
}
.btn-delete:hover { background: #dc2626; }

.back-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    color: #6b7280;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    text-decoration: none;
}
.back-link:hover {
    color: #1a1a1a;
    background: #f8f9fa;
}

/* Table */
.related-orders-section {
    margin-top: 50px;
}
.table-container {
    background: #ffffff;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    overflow: hidden;
}
.table thead th {
    font-weight: 600;
    font-size: 13px;
    text-transform: uppercase;
    padding: 12px;
}
.table tbody td {
    padding: 10px;
    font-size: 14px;
}
.table tbody td a {
    padding: 6px 14px;
    margin-right: 6px;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 500;
    text-decoration: none;
    color: white;
}
.table tbody td a.show-btn { background: #3b82f6; }
.table tbody td a.edit-btn { background: #8b5cf6; }
.empty-state {
    text-align: center;
    padding: 20px;
    color: #9ca3af;
}
</style>
{% endblock %}

{% block body %}
<section class="client-form-section">
    <div class="page-header">
        <h1>Edit Client</h1>
        <p>Update client information below.</p>
    </div>

    <div class="form-container">
        {{ form_start(form) }}
            {{ form_row(form.name) }}
            {{ form_row(form.email) }}
            {{ form_row(form.phone) }}
            {{ form_row(form.address) }}
            {{ form_row(form.status) }}

            <div class="form-actions">
                <a href="{{ path('app_client_index') }}" class="back-link">
                    ← Back to List
                </a>
                <button type="submit" class="btn btn-update">Update</button>
            </div>
        {{ form_end(form) }}

        <!-- Separate delete form (not nested) -->
        <form method="post" action="{{ path('app_client_delete', {'id': client.id}) }}"
              onsubmit="return confirm('Are you sure you want to delete this client?');"
              style="margin-top: 20px;">
            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ client.id) }}">
            <button class="btn btn-delete" type="submit">Delete Client</button>
        </form>
    </div>

    <section class="related-orders-section">
        <h2>Related Orders</h2>
        <div class="table-container">
            <table class="table" id="relatedTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Service</th>
                        <th>Total Price</th>
                        <th>Status</th>
                        <th>Order Date</th>
                        <th>Delivery Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% if client.orders|length > 0 %}
                        {% for order in client.orders %}
                        <tr>
                            <td>{{ order.id }}</td>
                            <td>{{ order.service ? order.service.name : 'N/A' }}</td>
                            <td>{{ order.totalPrice ? '₱' ~ order.totalPrice : 'N/A' }}</td>
                            <td>{{ order.status }}</td>
                            <td>{{ order.orderDate ? order.orderDate|date('Y-m-d H:i') : 'N/A' }}</td>
                            <td>{{ order.deliveryDate ? order.deliveryDate|date('Y-m-d') : 'N/A' }}</td>
                            <td>
                                <a href="{{ path('app_order_show', {'id': order.id}) }}" class="show-btn">Show</a>
                                <a href="{{ path('app_order_edit', {'id': order.id}) }}" class="edit-btn">Edit</a>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr><td colspan="7" class="empty-state">No orders found for this client.</td></tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </section>
</section>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

{% if client.orders|length > 0 %}
<script>
$(document).ready(function() {
    $('#relatedTable').DataTable({
        paging: true,
        searching: true,
        ordering: true,
        info: true,
        pageLength: 10,
        lengthMenu: [5, 10, 20, 50],
        order: [[0, 'desc']],
        columnDefs: [
            { orderable: false, targets: -1 }
        ],
        language: {
            search: "Search:",
            lengthMenu: "Show _MENU_ entries",
            info: "Showing _START_ to _END_ of _TOTAL_ orders",
            infoEmpty: "Showing 0 to 0 of 0 orders",
            infoFiltered: "(filtered from _MAX_ total orders)",
            paginate: {
                first: "First",
                last: "Last",
                next: "Next",
                previous: "Previous"
            }
        }
    });
});
</script>
{% endif %}
{% endblock %}
